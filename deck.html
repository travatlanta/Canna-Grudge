<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sponsorship Deck • CannaGrudge</title>
  <link rel="stylesheet" href="theme.css">
  <style>
    .deck-container {
      max-width: 1000px;
      margin: 40px auto 80px;
      padding: 0 16px;
    }
    .deck-container h1 {
      margin: 0 0 8px;
    }
    .deck-container p {
      margin: 0 0 18px;
    }

    .deck-slider {
      position: relative;
      overflow: auto;
      display: flex;
      gap: 12px;
      scroll-snap-type: x mandatory;
      padding-bottom: 8px;
      border-radius: var(--cg-r-lg);
      box-shadow: var(--cg-elev);
      background: var(--cg-surface);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid var(--cg-border);
      scrollbar-width: thin;
      scrollbar-color: rgba(245,184,26,0.22) transparent;
    }
    .deck-slider::-webkit-scrollbar {
      height: 6px;
    }
    .deck-slider::-webkit-scrollbar-track {
      background: transparent;
    }
    .deck-slider::-webkit-scrollbar-thumb {
      background: rgba(245,184,26,0.22);
      border-radius: 3px;
    }

    .deck-slide {
      flex: 0 0 100%;
      scroll-snap-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--cg-surface);
      border-radius: var(--cg-r-lg);
    }
    .deck-slide img {
      width: 100%;
      height: calc(100vh - var(--cg-nav-h) - 240px);
      object-fit: contain;
      border-radius: var(--cg-r-lg);
      background: var(--cg-ink-925);
    }

    .deck-controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 12px 0 6px;
    }
    .deck-btn {
      background: var(--cg-surface-2);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border: 1px solid var(--cg-border);
      color: var(--cg-text-strong);
      border-radius: var(--cg-r-md);
      padding: 8px 16px;
      cursor: pointer;
      font-weight: 600;
      transition: transform .08s ease, border-color .25s ease, box-shadow .25s ease;
    }
    .deck-btn:hover {
      border-color: rgba(245, 184, 26, .2);
      box-shadow: 0 0 12px rgba(245, 184, 26, .1);
    }
    .deck-btn:active {
      transform: translateY(1px);
    }

    .sponsor-form {
      margin-top: 24px;
      display: grid;
      gap: 12px;
      background: var(--cg-surface);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border-radius: var(--cg-r-lg);
      padding: 24px;
      border: 1px solid var(--cg-border);
      box-shadow: var(--cg-elev);
    }
    .sponsor-form h2 {
      border-bottom: 2px solid var(--cg-gold-300);
      padding-bottom: 12px;
      margin: 0;
    }
    .sponsor-form .row {
      display: grid;
      gap: 12px;
    }
    @media(min-width: 720px) {
      .sponsor-form .row {
        grid-template-columns: 1fr 1fr;
      }
    }
    .sponsor-form label {
      font-weight: 700;
      font-size: 14px;
      color: var(--cg-text-strong);
    }
    .sponsor-form input,
    .sponsor-form select,
    .sponsor-form textarea {
      width: 100%;
      padding: 12px;
      border-radius: var(--cg-r-sm);
      border: 1px solid var(--cg-border);
      background: var(--cg-surface-2);
      color: var(--cg-text);
      font-size: 14px;
      transition: border-color .2s ease, box-shadow .2s ease;
    }
    .sponsor-form input:focus,
    .sponsor-form select:focus,
    .sponsor-form textarea:focus {
      outline: none;
      border-color: rgba(245, 184, 26, .3);
      box-shadow: 0 0 8px rgba(245, 184, 26, .1);
    }
    .sponsor-form textarea {
      min-height: 120px;
      resize: vertical;
    }
    .toast {
      display: none;
      margin-top: 8px;
      padding: 10px 12px;
      border-radius: var(--cg-r-sm);
      background: rgba(22, 163, 74, .18);
      border: 1px solid rgba(22, 163, 74, .38);
      color: var(--cg-text-strong);
      font-size: 14px;
    }
    .toast.show {
      display: block;
    }
  </style>
</head>
<body class="page-padded">
  <div id="deckGate" style="max-width:500px;margin:120px auto;padding:0 20px;text-align:center;">
    <h2 style="font-family:var(--cg-font-display,sans-serif);font-size:28px;font-weight:800;margin-bottom:12px;">Sponsorship Deck</h2>
    <p id="gateMsg" style="color:var(--cg-text-secondary,#999);margin-bottom:24px;">Verifying access...</p>
    <a href="sponsors.html" class="btn btn-primary" style="display:none;" id="gateRequestBtn">Request Access</a>
  </div>
  <main class="deck-container" id="deckMain" style="display:none;">
    <h1 data-animate>Sponsorship Deck</h1>
    <p data-animate>Swipe or use the controls to view the CannaGrudge sponsorship deck one page at a time.</p>

    <div class="deck-slider" id="deckSlider" aria-label="Sponsorship deck pages" data-animate>
      <div class="deck-slide"><img src="assets/deck/1.png" alt="Deck page 1" loading="lazy"></div>
      <div class="deck-slide"><img src="assets/deck/2.png" alt="Deck page 2" loading="lazy"></div>
      <div class="deck-slide"><img src="assets/deck/3.png" alt="Deck page 3" loading="lazy"></div>
      <div class="deck-slide"><img src="assets/deck/4.png" alt="Deck page 4" loading="lazy"></div>
      <div class="deck-slide"><img src="assets/deck/5.png" alt="Deck page 5" loading="lazy"></div>
      <div class="deck-slide"><img src="assets/deck/6.png" alt="Deck page 6" loading="lazy"></div>
      <div class="deck-slide"><img src="assets/deck/7.png" alt="Deck page 7" loading="lazy"></div>
      <div class="deck-slide"><img src="assets/deck/8.png" alt="Deck page 8" loading="lazy"></div>
      <div class="deck-slide"><img src="assets/deck/9.png" alt="Deck page 9" loading="lazy"></div>
      <div class="deck-slide"><img src="assets/deck/10.png" alt="Deck page 10" loading="lazy"></div>
      <div class="deck-slide"><img src="assets/deck/11.png" alt="Deck page 11" loading="lazy"></div>
      <div class="deck-slide"><img src="assets/deck/12.png" alt="Deck page 12" loading="lazy"></div>
      <div class="deck-slide"><img src="assets/deck/13.png" alt="Deck page 13" loading="lazy"></div>
      <div class="deck-slide"><img src="assets/deck/14.png" alt="Deck page 14" loading="lazy"></div>
      <div class="deck-slide"><img src="assets/deck/15.png" alt="Deck page 14" loading="lazy"></div>
    </div>

    <div class="deck-controls" data-animate>
      <button type="button" class="deck-btn" id="prevSlide">◀ Prev</button>
      <button type="button" class="deck-btn" id="nextSlide">Next ▶</button>
    </div>

    <p style="margin-top:16px;" data-animate>
      <button type="button" id="downloadPdfBtn" class="button button--primary">Download PDF</button>
    </p>

    <form id="sponsorForm" class="sponsor-form" novalidate data-animate>
      <h2>Interested in Sponsoring?</h2>
      <div class="row">
        <div>
          <label for="brand">Brand name</label>
          <input id="brand" name="brand" type="text" placeholder="Brand Inc." required>
        </div>
        <div>
          <label for="contact">Contact name</label>
          <input id="contact" name="contact" type="text" placeholder="Jane Smith" required>
        </div>
      </div>
      <div class="row">
        <div>
          <label for="level">Sponsorship level</label>
          <select id="level" name="level" required>
            <option value="" disabled selected>Select a level</option>
            <option>VIP Sponsor</option>
            <option>Gold Sponsor</option>
            <option>Stage Sponsor</option>
            <option>DJ Sponsor</option>
            <option>Food Truck Space</option>
            <option>10x10 Booth</option>
            <option>10x20 Booth</option>
            <option>Ring Sponsor</option>
            <option>Mud Wrestling</option>
            <option>Halftime Show</option>
            <option>Custom</option>
          </select>
        </div>
        <div>
          <label for="email">Contact email</label>
          <input id="email" name="email" type="email" placeholder="name@brand.com">
        </div>
      </div>
      <div>
        <label for="message">Message</label>
        <textarea id="message" name="message" placeholder="Tell us what you have in mind…"></textarea>
      </div>
      <div style="display:flex;gap:10px;align-items:center;">
        <button class="button button--primary" type="submit">Send</button>
        <div id="sponsorToast" class="toast">Thanks! We'll be in touch.</div>
      </div>
    </form>
  </main>

  <script src="app.js?v=2"></script>
  <script type="module" src="./firebase-config.js"></script>

  <script>
  (function() {
    const params = new URLSearchParams(location.search);
    const token = params.get('token');
    const gate = document.getElementById('deckGate');
    const main = document.getElementById('deckMain');
    const msg = document.getElementById('gateMsg');
    const reqBtn = document.getElementById('gateRequestBtn');

    if (!token) {
      msg.textContent = 'Access to the sponsorship deck requires a valid invitation link.';
      reqBtn.style.display = '';
      return;
    }

    fetch('/api/sponsors/deck-access?token=' + encodeURIComponent(token))
      .then(r => r.json())
      .then(data => {
        if (data.access) {
          gate.style.display = 'none';
          main.style.display = '';
        } else {
          msg.textContent = data.error || 'Access denied. Your link may have expired.';
          reqBtn.style.display = '';
        }
      })
      .catch(() => {
        msg.textContent = 'Could not verify access. Please try again.';
        reqBtn.style.display = '';
      });
  })();
  </script>

  <script>
  (function() {
    const slider = document.getElementById('deckSlider');
    if (!slider) return;
    const slides = Array.from(slider.querySelectorAll('.deck-slide'));
    const prev = document.getElementById('prevSlide');
    const next = document.getElementById('nextSlide');
    const getIndex = () => Math.round(slider.scrollLeft / slider.clientWidth);
    const goTo = (i) => {
      const index = Math.max(0, Math.min(i, slides.length - 1));
      slider.scrollTo({ left: index * slider.clientWidth, behavior: 'smooth' });
    };
    if (prev) prev.addEventListener('click', () => goTo(getIndex() - 1));
    if (next) next.addEventListener('click', () => goTo(getIndex() + 1));
    slider.addEventListener('wheel', (e) => {
      if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {
        e.preventDefault();
        goTo(getIndex() + (e.deltaY > 0 ? 1 : -1));
      }
    }, { passive: false });
    slider.tabIndex = 0;
    slider.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight') goTo(getIndex() + 1);
      if (e.key === 'ArrowLeft')  goTo(getIndex() - 1);
    });
  })();

  (function() {
    const form = document.getElementById('sponsorForm');
    const toast = document.getElementById('sponsorToast');
    if (!form) return;
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      if (toast) {
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 4000);
      }
      form.reset();
    });
  })();

  (function() {
    const btn = document.getElementById('downloadPdfBtn');
    if (!btn) return;
    btn.addEventListener('click', async () => {
      if (!window.jspdf) {
        await new Promise((resolve, reject) => {
          const script = document.createElement('script');
          script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
          script.onload = resolve;
          script.onerror = reject;
          document.body.appendChild(script);
        });
      }
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
      const pages = [
        '1.png','2.png','3.png','4.png','5.png','6.png','7.png',
        '8.png','9.png','10.png','11.png','12.png','13.png','14.png','15.png'
      ];
      for (let i = 0; i < pages.length; i++) {
        const path = `assets/deck/${pages[i]}`;
        try {
          const resp = await fetch(path);
          if (!resp.ok) throw new Error('Image not found');
          const blob = await resp.blob();
          const dataUrl = await new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.readAsDataURL(blob);
          });
          if (i > 0) pdf.addPage('a4', 'portrait');
          const pageWidth = pdf.internal.pageSize.getWidth();
          const pageHeight = pdf.internal.pageSize.getHeight();
          pdf.setFillColor(24, 26, 30);
          pdf.rect(0, 0, pageWidth, pageHeight, 'F');
          const imgProps = pdf.getImageProperties(dataUrl);
          const margin = 10;
          const maxW = pageWidth - margin * 2;
          const maxH = pageHeight - margin * 2;
          let imgW = maxW;
          let imgH = (imgProps.height * maxW) / imgProps.width;
          if (imgH > maxH) {
            imgH = maxH;
            imgW = (imgProps.width * maxH) / imgProps.height;
          }
          const x = (pageWidth - imgW) / 2;
          const y = (pageHeight - imgH) / 2;
          pdf.addImage(dataUrl, 'PNG', x, y, imgW, imgH);
        } catch (e) {
          continue;
        }
      }
      pdf.save('CannaGrudge_Sponsorship_Deck.pdf');
    });
  })();
  </script>

  <footer class="footer footer--stack">
    <div class="footer__share"><img src="assets/Icons/share-online.png" alt="Share Online" /></div>
    <div class="footer__icons">
      <a href="https://www.instagram.com/?url=https%3A%2F%2Fcannagrudge.com" target="_blank" data-share="instagram" title="Share on Instagram"><img src="assets/Icons/instagram.png" alt="Instagram" /></a>
      <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fcannagrudge.com" target="_blank" data-share="facebook" title="Share on Facebook"><img src="assets/Icons/facebook.png" alt="Facebook" /></a>
      <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fcannagrudge.com" target="_blank" data-share="twitter" title="Share on X"><img src="assets/Icons/twitter.png" alt="X" /></a>
      <a href="https://www.snapchat.com/share?link=https%3A%2F%2Fcannagrudge.com" target="_blank" data-share="snapchat" title="Share on Snapchat"><img src="assets/Icons/snapchat.png" alt="Snapchat" /></a>
      <a href="https://www.tiktok.com/" target="_blank" data-share="tiktok" title="Share on TikTok"><img src="assets/Icons/tik tok.png" alt="TikTok" /></a>
    </div>
    <div class="footer__links">
      <a href="event.html#info">Event Info</a>
      <a href="event.html#vendors">Vendors</a>
      <a href="event.html#tickets">Tickets</a>
      <a href="tos.html">Terms &amp; Conditions</a>
      <a href="privacy.html">Privacy Policy</a>
    </div>
    <div class="footer__legal">© CannaGrudge. All rights reserved.</div>
  </footer>
</body>
</html>
