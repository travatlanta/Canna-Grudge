<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Login • CannaGrudge</title>
  <link rel="stylesheet" href="theme.css">
  <style>
    .login-wrap{max-width:420px;margin:60px auto 24px;padding:16px;text-align:center}
    .login-title{font-size:2.2rem;font-weight:1000;margin-bottom:24px}
    .text-gradient{background:linear-gradient(135deg,var(--cg-gold-300),var(--cg-gold-200));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .login-card{background:var(--cg-surface);backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);border:1px solid rgba(245,184,26,.12);border-radius:var(--cg-r-lg);padding:32px 24px;box-shadow:var(--cg-elev),0 0 30px rgba(245,184,26,.06);transition:border-color .3s ease,box-shadow .3s ease}
    .login-card:hover{border-color:rgba(245,184,26,.2);box-shadow:var(--cg-elev),0 0 40px rgba(245,184,26,.1)}
    .login-card h1{margin:0 0 6px;color:var(--cg-text-strong)}
    .login-card .muted{color:var(--cg-text-dim);font-size:14px;margin-bottom:20px}
    .auth-btn{display:block;width:100%;margin:10px 0;padding:14px 16px;border-radius:var(--cg-r-pill);border:1px solid rgba(255,255,255,.08);font-weight:800;font-size:15px;text-align:center;cursor:pointer;color:#fff;transition:transform .1s ease,box-shadow .25s ease,border-color .25s ease;letter-spacing:.01em}
    .auth-btn:active{transform:translateY(1px) scale(.995)}
    .auth-btn:hover{box-shadow:0 0 20px rgba(255,255,255,.08);border-color:rgba(255,255,255,.18)}
    .auth-btn.g{background:linear-gradient(135deg,#0F9D58,#0a7a42)}
    .auth-btn.g:hover{box-shadow:0 0 20px rgba(15,157,88,.3)}
    .auth-btn.f{background:linear-gradient(135deg,#1877F2,#0d5bbf)}
    .auth-btn.f:hover{box-shadow:0 0 20px rgba(24,119,242,.3)}
    .auth-btn.a{background:linear-gradient(135deg,#333,#111);border-color:rgba(255,255,255,.12)}
    .auth-btn.a:hover{box-shadow:0 0 20px rgba(255,255,255,.08);border-color:rgba(255,255,255,.2)}
    .login-footer-note{color:var(--cg-text-dim);opacity:.8;font-size:13px;margin-top:16px}
    [data-animate]{opacity:0;transform:translateY(24px);transition:opacity .6s ease,transform .6s ease}
    [data-animate].visible{opacity:1;transform:translateY(0)}
  </style>
</head>
<body class="with-dock">
  <main class="container">
    <div class="login-wrap">
      <div class="login-title text-gradient">CannaGrudge</div>
      <div class="login-card" data-animate>
        <h1>Sign in</h1>
        <div class="muted">Use a provider below to access your dashboard.</div>
        <button id="btnGoogle" class="auth-btn g">Continue with Google</button>
        <button id="btnFacebook" class="auth-btn f">Continue with Facebook</button>
        <button id="btnApple" class="auth-btn a">Continue with Apple</button>
        <div class="login-footer-note">If a provider isn't enabled yet, you'll get an error. Start with Google.</div>
      </div>
    </div>
  </main>

  <script type="module" src="./firebase-config.js"></script>
  <script type="module">
    const { auth, signInWithPopup, googleProvider, facebookProvider, appleProvider, onAuthStateChanged } = window.__cgAuth;
    // If a return URL was passed, redirect back there after login
    const ret = new URLSearchParams(location.search).get('return');
    const go = () => location.href = ret ? decodeURIComponent(ret) : 'dashboard.html';
    // Attach handlers for each provider
    document.getElementById('btnGoogle').onclick  = () => {
      signInWithPopup(auth, googleProvider)
        .then(result => {
          // Mark the user as logged in for the global auth guard
          localStorage.setItem('isLoggedIn', '1');
          // Persist the user's display name and avatar so the bottom nav
          // can show their name and photo.  Use the provider result if available,
          // otherwise fall back to the current user on the auth instance.
          const user = result.user;
          const name = (user && user.displayName) || (auth.currentUser && auth.currentUser.displayName) || '';
          const avatarUrl = (user && user.photoURL) || (auth.currentUser && auth.currentUser.photoURL) || '';
          if (name) localStorage.setItem('fullName', name);
          if (avatarUrl) localStorage.setItem('avatarUrl', avatarUrl);
          go();
        })
        .catch(e => alert(e.message || e));
    };
    document.getElementById('btnFacebook').onclick = () => {
      signInWithPopup(auth, facebookProvider)
        .then(result => {
          localStorage.setItem('isLoggedIn', '1');
          const user = result.user;
          const name = (user && user.displayName) || (auth.currentUser && auth.currentUser.displayName) || '';
          const avatarUrl = (user && user.photoURL) || (auth.currentUser && auth.currentUser.photoURL) || '';
          if (name) localStorage.setItem('fullName', name);
          if (avatarUrl) localStorage.setItem('avatarUrl', avatarUrl);
          go();
        })
        .catch(e => alert(e.message || e));
    };
    document.getElementById('btnApple').onclick   = () => {
      signInWithPopup(auth, appleProvider)
        .then(result => {
          localStorage.setItem('isLoggedIn', '1');
          const user = result.user;
          const name = (user && user.displayName) || (auth.currentUser && auth.currentUser.displayName) || '';
          const avatarUrl = (user && user.photoURL) || (auth.currentUser && auth.currentUser.photoURL) || '';
          if (name) localStorage.setItem('fullName', name);
          if (avatarUrl) localStorage.setItem('avatarUrl', avatarUrl);
          go();
        })
        .catch(e => alert(e.message || e));
    };
    // Automatically redirect if already signed in
    onAuthStateChanged(auth, user => {
      if (user) {
        localStorage.setItem('isLoggedIn', '1');
        // Persist name and avatar for nav display.  Use displayName/photoURL
        // if available; if not, don't overwrite existing values so manual
        // logins (email) can set name later.
        const name = user.displayName;
        const avatarUrl = user.photoURL;
        if (name) localStorage.setItem('fullName', name);
        if (avatarUrl) localStorage.setItem('avatarUrl', avatarUrl);
        go();
      }
    });
  </script>
  <footer class="footer footer--stack">
    <div class="footer__share"><img src="assets/Icons/share-online.png" alt="Share Online" /></div>
    <div class="footer__icons">
      <a href="https://www.instagram.com/?url=https%3A%2F%2Fcannagrudge.com" target="_blank" data-share="instagram" title="Share on Instagram"><img src="assets/Icons/instagram.png" alt="Instagram" /></a>
      <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fcannagrudge.com" target="_blank" data-share="facebook" title="Share on Facebook"><img src="assets/Icons/facebook.png" alt="Facebook" /></a>
      <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fcannagrudge.com" target="_blank" data-share="twitter" title="Share on X"><img src="assets/Icons/twitter.png" alt="X" /></a>
      <a href="https://www.snapchat.com/share?link=https%3A%2F%2Fcannagrudge.com" target="_blank" data-share="snapchat" title="Share on Snapchat"><img src="assets/Icons/snapchat.png" alt="Snapchat" /></a>
      <a href="https://www.tiktok.com/" target="_blank" data-share="tiktok" title="Share on TikTok"><img src="assets/Icons/tik tok.png" alt="TikTok" /></a>
    </div>
    <!-- Simplified site map: only the key pages remain -->
    <div class="footer__links">
      <a href="event.html#info">Event Info</a>
      <a href="event.html#vendors">Vendors</a>
      <a href="event.html#tickets">Tickets</a>
      <a href="tos.html">Terms &amp; Conditions</a>
      <a href="privacy.html">Privacy Policy</a>
    </div>
    <div class="footer__legal">© CannaGrudge. All rights reserved.</div>
  </footer>
  <script src="app.js"></script>
  <!-- The bottom navigation is dynamically injected by app.js -->
</body>
</html>
