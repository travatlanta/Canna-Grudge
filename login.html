<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Login • CannaGrudge</title>
  <link rel="stylesheet" href="theme.css">
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;margin:0;background:#0f1012;color:#eaecef}
    .wrap{max-width:720px;margin:24px auto;padding:16px}
    .card{background:#181b20;border:1px solid #2a2f36;border-radius:16px;padding:16px;box-shadow:0 4px 24px rgba(0,0,0,.28)}
    .btn{display:block;width:100%;margin:10px 0;padding:14px 16px;border-radius:999px;border:1px solid rgba(255,255,255,.1);
         font-weight:800;text-align:center;cursor:pointer;transition:.12s all}
    .btn:active{transform:translateY(1px) scale(.995)}
    .g{background:#0F9D58;color:#fff}
    .f{background:#1877F2;color:#fff}
    .a{background:#000;color:#fff;border-color:#333}
    .muted{opacity:.8;font-size:14px;margin-top:8px}
  </style>
</head>
<body class="with-dock">
  <!-- Use a main container so the bottom nav can compute proper padding -->
  <main class="container">
    <div class="card" style="max-width:720px;margin:24px auto 8px;padding:16px;">
      <h1 style="margin:0 0 6px;">Sign in</h1>
      <div class="muted">Use a provider below to access your dashboard.</div>

      <!-- Use Firebase providers for real authentication -->
      <button id="btnGoogle" class="btn g">Continue with Google</button>
      <button id="btnFacebook" class="btn f">Continue with Facebook</button>
      <button id="btnApple" class="btn a">Continue with Apple</button>
      <div class="muted">If a provider isn't enabled yet, you'll get an error. Start with Google.</div>
    </div>
  </main>

  <!-- Restore Firebase providers for real authentication. -->
  <script type="module" src="./firebase-config.js"></script>
  <script type="module">
    const { auth, signInWithPopup, googleProvider, facebookProvider, appleProvider, onAuthStateChanged } = window.__cgAuth;
    // If a return URL was passed, redirect back there after login
    const ret = new URLSearchParams(location.search).get('return');
    const go = () => location.href = ret ? decodeURIComponent(ret) : 'dashboard.html';
    // Attach handlers for each provider
    document.getElementById('btnGoogle').onclick  = () => {
      signInWithPopup(auth, googleProvider)
        .then(result => {
          // Mark the user as logged in for the global auth guard
          localStorage.setItem('isLoggedIn', '1');
          // Persist the user's display name and avatar so the bottom nav
          // can show their name and photo.  Use the provider result if available,
          // otherwise fall back to the current user on the auth instance.
          const user = result.user;
          const name = (user && user.displayName) || (auth.currentUser && auth.currentUser.displayName) || '';
          const avatarUrl = (user && user.photoURL) || (auth.currentUser && auth.currentUser.photoURL) || '';
          if (name) localStorage.setItem('fullName', name);
          if (avatarUrl) localStorage.setItem('avatarUrl', avatarUrl);
          go();
        })
        .catch(e => alert(e.message || e));
    };
    document.getElementById('btnFacebook').onclick = () => {
      signInWithPopup(auth, facebookProvider)
        .then(result => {
          localStorage.setItem('isLoggedIn', '1');
          const user = result.user;
          const name = (user && user.displayName) || (auth.currentUser && auth.currentUser.displayName) || '';
          const avatarUrl = (user && user.photoURL) || (auth.currentUser && auth.currentUser.photoURL) || '';
          if (name) localStorage.setItem('fullName', name);
          if (avatarUrl) localStorage.setItem('avatarUrl', avatarUrl);
          go();
        })
        .catch(e => alert(e.message || e));
    };
    document.getElementById('btnApple').onclick   = () => {
      signInWithPopup(auth, appleProvider)
        .then(result => {
          localStorage.setItem('isLoggedIn', '1');
          const user = result.user;
          const name = (user && user.displayName) || (auth.currentUser && auth.currentUser.displayName) || '';
          const avatarUrl = (user && user.photoURL) || (auth.currentUser && auth.currentUser.photoURL) || '';
          if (name) localStorage.setItem('fullName', name);
          if (avatarUrl) localStorage.setItem('avatarUrl', avatarUrl);
          go();
        })
        .catch(e => alert(e.message || e));
    };
    // Automatically redirect if already signed in
    onAuthStateChanged(auth, user => {
      if (user) {
        localStorage.setItem('isLoggedIn', '1');
        // Persist name and avatar for nav display.  Use displayName/photoURL
        // if available; if not, don't overwrite existing values so manual
        // logins (email) can set name later.
        const name = user.displayName;
        const avatarUrl = user.photoURL;
        if (name) localStorage.setItem('fullName', name);
        if (avatarUrl) localStorage.setItem('avatarUrl', avatarUrl);
        go();
      }
    });
  </script>
  <footer class="footer footer--stack">
    <div class="footer__share"><img src="assets/Icons/share-online.png" alt="Share Online" /></div>
    <div class="footer__icons">
      <a href="https://www.instagram.com/?url=https%3A%2F%2Fcannagrudge.com" target="_blank" data-share="instagram" title="Share on Instagram"><img src="assets/Icons/instagram.png" alt="Instagram" /></a>
      <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fcannagrudge.com" target="_blank" data-share="facebook" title="Share on Facebook"><img src="assets/Icons/facebook.png" alt="Facebook" /></a>
      <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fcannagrudge.com" target="_blank" data-share="twitter" title="Share on X"><img src="assets/Icons/twitter.png" alt="X" /></a>
      <a href="https://www.snapchat.com/share?link=https%3A%2F%2Fcannagrudge.com" target="_blank" data-share="snapchat" title="Share on Snapchat"><img src="assets/Icons/snapchat.png" alt="Snapchat" /></a>
      <a href="https://www.tiktok.com/" target="_blank" data-share="tiktok" title="Share on TikTok"><img src="assets/Icons/tik tok.png" alt="TikTok" /></a>
    </div>
    <!-- Simplified site map: only the key pages remain -->
    <div class="footer__links">
      <a href="event.html#info">Event Info</a>
      <a href="event.html#vendors">Vendors</a>
      <a href="event.html#tickets">Tickets</a>
      <a href="tos.html">Terms &amp; Conditions</a>
      <a href="privacy.html">Privacy Policy</a>
    </div>
    <div class="footer__legal">© CannaGrudge. All rights reserved.</div>
  </footer>
  <script src="app.js"></script>
  <nav class="bottom-nav">
    <a href="event.html">Event Info</a>
    <a href="index.html" class="home" aria-label="Home">
      <img src="assets/Icons/home.png" alt="Home" width="22" height="22" />
      <span class="sr-only">Home</span>
    </a>
    <a href="dashboard.html">Dashboard</a>
  </nav>
</body>
</html>
