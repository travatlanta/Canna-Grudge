<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard â€¢ CannaGrudge</title>
  <link rel="stylesheet" href="theme.css">
  <style>
    .dash-grid { display:grid; grid-template-columns:1fr 2fr; gap:24px; }
    @media (max-width:768px) { .dash-grid { grid-template-columns:1fr; } }
  </style>
</head>
<body class="page-padded">

  <div class="container">
    <div class="page-header">
      <h1>My <span class="text-gradient">Account</span></h1>
      <p class="text-secondary">Manage your profile and tickets</p>
    </div>

    <div class="dash-grid">

      <div class="card" style="padding:24px;text-align:center;">
        <div id="profileInitials" style="width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,var(--cg-gold),#b8922e);display:flex;align-items:center;justify-content:center;margin:0 auto 12px;font-family:var(--cg-font-display);font-size:28px;font-weight:800;color:#1a1a1a;"></div>
        <img id="profileImage" class="profile-avatar" alt="Profile" style="display:none;margin:0 auto 12px;">
        <input type="file" id="profileUpload" accept="image/*" style="display:none;">
        <button class="btn btn-ghost btn-sm" id="changePhoto">Change Photo</button>
        <h2 id="name" style="margin-top:12px;">Loading...</h2>
        <p class="text-secondary" id="email">-</p>
        <p class="text-muted" id="provider">-</p>
        <div class="divider"></div>
        <div style="display:flex;flex-direction:column;gap:8px;">
          <a href="admin.html" class="btn btn-primary btn-block btn-sm" id="adminLink">Admin Dashboard</a>
          <button class="btn btn-outline btn-block btn-sm" id="editProfile">Edit Profile</button>
          <button class="btn btn-ghost btn-block btn-sm" id="logout" style="color:var(--cg-red);">Sign Out</button>
        </div>
      </div>

      <div>
        <div class="card" style="padding:24px;">
          <h3>My Tickets</h3>
          <div id="ticketsList">No tickets purchased yet.</div>
          <a href="tickets.html" class="btn btn-primary btn-sm" style="margin-top:16px;">Browse Tickets</a>
        </div>

        <div class="card" style="margin-top:24px;padding:24px;">
          <h3>Order History</h3>
          <div id="orderHistory">No orders yet.</div>
        </div>
      </div>

    </div>
  </div>

  <footer class="footer" data-animate="fade">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-col">
          <div class="footer-brand">Canna<span>Grudge</span></div>
          <p class="footer-desc">The ultimate cannabis boxing event. Live fights, music, vendors, and more in Litchfield Park, AZ.</p>
          <div class="footer-social">
            <a href="https://www.instagram.com/" target="_blank" aria-label="Instagram"><img src="assets/Icons/instagram.png" alt="Instagram"></a>
            <a href="https://www.facebook.com/" target="_blank" aria-label="Facebook"><img src="assets/Icons/facebook.png" alt="Facebook"></a>
            <a href="https://twitter.com/" target="_blank" aria-label="X"><img src="assets/Icons/twitter.png" alt="X"></a>
          </div>
        </div>
        <div class="footer-col">
          <h4>Event</h4>
          <a href="index.html">Home</a>
          <a href="event.html">Event Info</a>
          <a href="sponsors.html">Sponsors</a>
          <a href="tickets.html">Tickets</a>
        </div>
        <div class="footer-col">
          <h4>Support</h4>
          <a href="event.html#faq">FAQ</a>
          <a href="event.html#contact">Contact</a>
          <a href="tos.html">Terms &amp; Conditions</a>
        </div>
        <div class="footer-col">
          <h4>Legal</h4>
          <a href="privacy.html">Privacy Policy</a>
          <a href="delete-data.html">Delete Data</a>
        </div>
      </div>
      <div class="footer-bottom">
        <span>&copy; 2026 CannaGrudge. All rights reserved.</span>
        <div>
          <a href="privacy.html">Privacy</a> &nbsp;&middot;&nbsp; <a href="tos.html">Terms</a>
        </div>
      </div>
    </div>
  </footer>

  <script src="api-config.js"></script>
  <script type="module" src="./firebase-config.js"></script>
  <script type="module">
const { auth, onAuthStateChanged, signOut } = window.__cgAuth;
const profileImageEl = document.getElementById('profileImage');
const changePhotoBtn = document.getElementById('changePhoto');
const profileUpload = document.getElementById('profileUpload');

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    location.href = 'login.html?return=' + encodeURIComponent(location.pathname);
    return;
  }
  const displayName = user.displayName || 'CannaGrudge User';
  document.getElementById('name').textContent = displayName;
  document.getElementById('email').textContent = user.email || '-';
  document.getElementById('provider').textContent = (user.providerData[0]?.providerId) || '-';

  const initials = displayName.split(' ').map(w => w[0]).join('').toUpperCase().slice(0, 3);
  document.getElementById('profileInitials').textContent = initials;

  const storedAvatar = localStorage.getItem('avatar');
  const photo = user.photoURL || storedAvatar;
  if (photo) {
    profileImageEl.src = photo;
    profileImageEl.style.display = '';
    document.getElementById('profileInitials').style.display = 'none';
  }

  const lastOrder = localStorage.getItem('cg_last_order');
  if (lastOrder) {
    try {
      const order = JSON.parse(lastOrder);
      const ticketsList = document.getElementById('ticketsList');
      ticketsList.innerHTML = order.items.map(item =>
        `<div style="display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--cg-border);"><span>${item.name} x${item.qty}</span><span class="text-gold">$${(item.price*item.qty/100).toFixed(2)}</span></div>`
      ).join('');

      const historyEl = document.getElementById('orderHistory');
      historyEl.innerHTML = `<div style="padding:12px 0;"><div style="display:flex;justify-content:space-between;margin-bottom:4px;"><span>Order #${order.paymentId?.slice(-8) || 'N/A'}</span><span class="text-gold">$${(order.total/100).toFixed(2)}</span></div><div class="text-muted" style="font-size:13px;">${new Date(order.date).toLocaleDateString()}</div></div>`;
    } catch(e) {}
  }
});

document.getElementById('logout').addEventListener('click', async () => {
  await signOut(auth);
  localStorage.removeItem('isLoggedIn');
  localStorage.removeItem('fullName');
  localStorage.removeItem('avatarUrl');
  localStorage.removeItem('avatar');
  location.href = 'login.html';
});

changePhotoBtn.addEventListener('click', () => profileUpload.click());
profileUpload.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (evt) => {
    profileImageEl.src = evt.target.result;
    localStorage.setItem('avatar', evt.target.result);
  };
  reader.readAsDataURL(file);
});

document.getElementById('editProfile').addEventListener('click', () => {
  const name = prompt('Enter your name:', document.getElementById('name').textContent);
  if (name !== null && name.trim()) {
    document.getElementById('name').textContent = name.trim();
    localStorage.setItem('fullName', name.trim());
  }
});
  </script>
  <script src="app.js?v=2"></script>
</body>
</html>